"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/tracking/live";
exports.ids = ["pages/api/tracking/live"];
exports.modules = {

/***/ "(api-node)/./lib/db/DatabaseManager.ts":
/*!***********************************!*\
  !*** ./lib/db/DatabaseManager.ts ***!
  \***********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DatabaseManager: () => (/* binding */ DatabaseManager),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var sqlite3__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! sqlite3 */ \"sqlite3\");\n/* harmony import */ var sqlite3__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(sqlite3__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var sqlite__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! sqlite */ \"sqlite\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_3__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([sqlite__WEBPACK_IMPORTED_MODULE_2__]);\nsqlite__WEBPACK_IMPORTED_MODULE_2__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// SimplifiedDatabaseManager.ts\n\n\n\n\n// The main database manager class\nclass DatabaseManager {\n    static{\n        this.instance = null;\n    }\n    constructor(dbPath){\n        this.db = null;\n        this.isInitialized = false;\n        this.cache = {};\n        this.dbPath = dbPath;\n        console.log(`[DB] Database path: ${this.dbPath}`);\n    }\n    /**\r\n   * Get singleton instance\r\n   */ static getInstance(dbPath) {\n        if (!DatabaseManager.instance) {\n            // First try to use the provided dbPath parameter\n            if (dbPath) {\n                DatabaseManager.instance = new DatabaseManager(dbPath);\n            } else {\n                // Otherwise, try to use the environment variable\n                const envPath = process.env.STATIC_DB_PATH;\n                if (!envPath) {\n                    throw new Error('STATIC_DB_PATH not defined in .env');\n                }\n                DatabaseManager.instance = new DatabaseManager(envPath);\n            }\n        }\n        return DatabaseManager.instance;\n    }\n    /**\r\n   * Initialize the database connection and create tables if needed\r\n   */ async initialize() {\n        if (this.isInitialized) return;\n        try {\n            // Ensure directory exists\n            const dbDir = path__WEBPACK_IMPORTED_MODULE_0___default().dirname(this.dbPath);\n            if (!fs__WEBPACK_IMPORTED_MODULE_3___default().existsSync(dbDir)) {\n                fs__WEBPACK_IMPORTED_MODULE_3___default().mkdirSync(dbDir, {\n                    recursive: true\n                });\n            }\n            // Open database connection\n            this.db = await (0,sqlite__WEBPACK_IMPORTED_MODULE_2__.open)({\n                filename: this.dbPath,\n                driver: (sqlite3__WEBPACK_IMPORTED_MODULE_1___default().Database)\n            });\n            // Set pragmas for better performance\n            await this.db.run('PRAGMA journal_mode = WAL;');\n            await this.db.run('PRAGMA busy_timeout = 5000;');\n            this.isInitialized = true;\n            console.log('[DB] Database initialized successfully');\n        } catch (error) {\n            console.error('[DB] Failed to initialize database:', error);\n            throw error;\n        }\n    }\n    /**\r\n   * Get data with caching\r\n   */ async query(cacheKey, sqlQuery, params = [], ttl = 300 // 5 minutes default TTL\n    ) {\n        // Check if we need to initialize first\n        if (!this.isInitialized) {\n            await this.initialize();\n        }\n        // Try to get from cache first\n        const cachedData = this.getFromCache(cacheKey);\n        if (cachedData) {\n            console.log(`[DB] Cache hit for: ${cacheKey}`);\n            return cachedData;\n        }\n        // Cache miss, execute query\n        console.log(`[DB] Cache miss for: ${cacheKey}, executing query`);\n        try {\n            const results = await this.db.all(sqlQuery, params);\n            // Store in cache\n            this.setInCache(cacheKey, results, ttl);\n            return results;\n        } catch (error) {\n            console.error(`[DB] Query error for ${cacheKey}:`, error);\n            throw error;\n        }\n    }\n    /**\r\n   * Get single item with caching\r\n   */ async getSingle(cacheKey, sqlQuery, params = [], ttl = 300) {\n        // Check if we need to initialize first\n        if (!this.isInitialized) {\n            await this.initialize();\n        }\n        // Try to get from cache first\n        const cachedData = this.getFromCache(cacheKey);\n        if (cachedData !== undefined) {\n            console.log(`[DB] Cache hit for: ${cacheKey}`);\n            return cachedData;\n        }\n        // Cache miss, execute query\n        console.log(`[DB] Cache miss for: ${cacheKey}, executing query`);\n        try {\n            const result = await this.db.get(sqlQuery, params);\n            // Store in cache (even if null)\n            this.setInCache(cacheKey, result || null, ttl);\n            return result || null;\n        } catch (error) {\n            console.error(`[DB] Query error for ${cacheKey}:`, error);\n            throw error;\n        }\n    }\n    /**\r\n   * Get manufacturers with aircraft count\r\n   */ async getManufacturersWithCount(limit = 75) {\n        const cacheKey = `manufacturers-count-${limit}`;\n        // Query with exact column case matching your schema\n        return this.query(cacheKey, `SELECT \n      MANUFACTURER AS name,  \n      COUNT(*) AS count \n    FROM aircraft \n    WHERE MANUFACTURER IS NOT NULL AND trim(MANUFACTURER) != '' \n    GROUP BY MANUFACTURER \n    HAVING count > 0 \n    ORDER BY count DESC \n    LIMIT ?`, [\n            limit\n        ], 600 // 10 minute cache\n        );\n    }\n    async getIcao24sForManufacturer(manufacturer, region) {\n        if (!this.isInitialized) {\n            console.log('[DB] Not initialized, calling initialize()');\n            await this.initialize();\n        }\n        const cacheKey = region ? `ICAO24s-${manufacturer.toUpperCase()}-${region}` : `ICAO24s-${manufacturer.toUpperCase()}`;\n        const cachedData = this.getFromCache(cacheKey);\n        if (cachedData) {\n            console.log(`[DB] Cache hit for: ${cacheKey}`);\n            return cachedData;\n        }\n        console.log(`[DB] Cache miss for: ${cacheKey}, executing query`);\n        try {\n            const queryParts = [\n                `SELECT DISTINCT ICAO24 FROM aircraft`,\n                `WHERE LOWER(MANUFACTURER) = LOWER(?)`,\n                `AND ICAO24 IS NOT NULL`\n            ];\n            const queryParams = [\n                manufacturer\n            ];\n            // Add region filtering if region is specified\n            if (region !== undefined) {\n                // Check if region is a number or string\n                if (typeof region === 'string' && !isNaN(parseInt(region, 10))) {\n                    // If it's a numeric string, convert to number\n                    queryParts.push(`AND REGION = ?`);\n                    queryParams.push(parseInt(region, 10));\n                } else if (typeof region === 'number') {\n                    // If it's already a number\n                    queryParts.push(`AND REGION = ?`);\n                    queryParams.push(region);\n                } else {\n                    // Assume it's a state string\n                    queryParts.push(`AND LOWER(STATE) = LOWER(?)`);\n                    queryParams.push(region);\n                }\n            }\n            const query = queryParts.join(' ');\n            const result = await this.db.all(query, queryParams);\n            const ICAO24s = result.map((row)=>row.ICAO24.toLowerCase());\n            console.log(`[DB] Retrieved ${ICAO24s.length} ICAO24s for ${manufacturer}${region ? ` in region/state ${region}` : ''}`);\n            this.setInCache(cacheKey, ICAO24s, 300);\n            return ICAO24s;\n        } catch (error) {\n            console.error(`[DB] Error retrieving ICAO24s for manufacturer ${manufacturer}${region ? ` in region/state ${region}` : ''}:`, error);\n            return [];\n        }\n    }\n    /**\r\n   * Get aircraft by ICAO24 codes\r\n   */ async getAircraftByIcao24s(ICAO24s) {\n        if (!Array.isArray(ICAO24s) || ICAO24s.length === 0) {\n            return [];\n        }\n        // Get individual aircraft from cache if possible\n        const result = [];\n        const missingIcao24s = [];\n        for (const icao of ICAO24s){\n            const cachedAircraft = this.getFromCache(`aircraft-${icao}`);\n            if (cachedAircraft) {\n                result.push(cachedAircraft);\n            } else {\n                missingIcao24s.push(icao);\n            }\n        }\n        // Fetch any missing aircraft\n        if (missingIcao24s.length > 0) {\n            const placeholders = missingIcao24s.map(()=>'?').join(',');\n            const query = `\n        SELECT *\n        FROM aircraft\n        WHERE ICAO24 IN (${placeholders})\n      `;\n            const fetchedAircraft = await this.query(`aircraft-batch-${Date.now()}`, query, missingIcao24s, 0 // Don't cache the batch query result\n            );\n            // Cache individual results\n            for (const aircraft of fetchedAircraft){\n                this.setInCache(`aircraft-${aircraft.ICAO24}`, aircraft, 300);\n                result.push(aircraft);\n            }\n        }\n        return result;\n    }\n    /**\r\n   * Get models by MANUFACTURER\r\n   */ async getModelsByManufacturer(MANUFACTURER) {\n        const cacheKey = `models-${MANUFACTURER}`;\n        return this.query(cacheKey, `SELECT \n        MODEL,\n        MANUFACTURER,\n        COUNT(DISTINCT ICAO24) as total_count,\n        MAX(NAME) as NAME,\n        MAX(CITY) as CITY,\n        MAX(STATE) as STATE,\n        MAX(TYPE_REGISTRANT) as TYPE_REGISTRANT\n      FROM aircraft\n      WHERE MANUFACTURER = ?\n      GROUP BY MODEL, MANUFACTURER\n      ORDER BY total_count DESC`, [\n            MANUFACTURER\n        ], 300 // 5 minute cache\n        );\n    }\n    /**\r\n   * Store data in cache\r\n   */ setInCache(key, data, ttl) {\n        this.cache[key] = {\n            data,\n            timestamp: Date.now(),\n            ttl: ttl * 1000\n        };\n    }\n    /**\r\n   * Get data from cache if valid\r\n   */ getFromCache(key) {\n        const entry = this.cache[key];\n        if (!entry) return undefined;\n        // Check if cache entry is still valid\n        const age = Date.now() - entry.timestamp;\n        if (age > entry.ttl) {\n            // Cache expired\n            delete this.cache[key];\n            return undefined;\n        }\n        return entry.data;\n    }\n    /**\r\n   * Clear entire cache or specific keys\r\n   */ clearCache(key) {\n        if (key) {\n            delete this.cache[key];\n            console.log(`[DB] Cleared cache for: ${key}`);\n        } else {\n            this.cache = {};\n            console.log('[DB] Cleared entire cache');\n        }\n    }\n    /**\r\n   * Close database connection\r\n   */ async close() {\n        if (this.db) {\n            await this.db.close();\n            this.db = null;\n            this.isInitialized = false;\n            console.log('[DB] Database connection closed');\n        }\n    }\n}\n// Export a singleton instance\nconst dbManager = DatabaseManager.getInstance();\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (dbManager);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9kYi9EYXRhYmFzZU1hbmFnZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsK0JBQStCO0FBQ1A7QUFDTTtBQUNVO0FBQ3BCO0FBYXBCLGtDQUFrQztBQUMzQixNQUFNSTs7YUFDSUMsV0FBbUM7O0lBTWxELFlBQW9CQyxNQUFjLENBQUU7YUFMNUJDLEtBQXdDO2FBQ3hDQyxnQkFBZ0I7YUFFaEJDLFFBQXNCLENBQUM7UUFHN0IsSUFBSSxDQUFDSCxNQUFNLEdBQUdBO1FBQ2RJLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLG9CQUFvQixFQUFFLElBQUksQ0FBQ0wsTUFBTSxFQUFFO0lBQ2xEO0lBRUE7O0dBRUMsR0FDRCxPQUFjTSxZQUFZTixNQUFlLEVBQW1CO1FBQzFELElBQUksQ0FBQ0YsZ0JBQWdCQyxRQUFRLEVBQUU7WUFDN0IsaURBQWlEO1lBQ2pELElBQUlDLFFBQVE7Z0JBQ1ZGLGdCQUFnQkMsUUFBUSxHQUFHLElBQUlELGdCQUFnQkU7WUFDakQsT0FBTztnQkFDTCxpREFBaUQ7Z0JBQ2pELE1BQU1PLFVBQVVDLFFBQVFDLEdBQUcsQ0FBQ0MsY0FBYztnQkFDMUMsSUFBSSxDQUFDSCxTQUFTO29CQUNaLE1BQU0sSUFBSUksTUFBTTtnQkFDbEI7Z0JBQ0FiLGdCQUFnQkMsUUFBUSxHQUFHLElBQUlELGdCQUFnQlM7WUFDakQ7UUFDRjtRQUNBLE9BQU9ULGdCQUFnQkMsUUFBUTtJQUNqQztJQUVBOztHQUVDLEdBQ0QsTUFBYWEsYUFBNEI7UUFDdkMsSUFBSSxJQUFJLENBQUNWLGFBQWEsRUFBRTtRQUV4QixJQUFJO1lBQ0YsMEJBQTBCO1lBQzFCLE1BQU1XLFFBQVFuQixtREFBWSxDQUFDLElBQUksQ0FBQ00sTUFBTTtZQUN0QyxJQUFJLENBQUNILG9EQUFhLENBQUNnQixRQUFRO2dCQUN6QmhCLG1EQUFZLENBQUNnQixPQUFPO29CQUFFSSxXQUFXO2dCQUFLO1lBQ3hDO1lBRUEsMkJBQTJCO1lBQzNCLElBQUksQ0FBQ2hCLEVBQUUsR0FBRyxNQUFNTCw0Q0FBSUEsQ0FBQztnQkFDbkJzQixVQUFVLElBQUksQ0FBQ2xCLE1BQU07Z0JBQ3JCbUIsUUFBUXhCLHlEQUFnQjtZQUMxQjtZQUVBLHFDQUFxQztZQUNyQyxNQUFNLElBQUksQ0FBQ00sRUFBRSxDQUFDb0IsR0FBRyxDQUFDO1lBQ2xCLE1BQU0sSUFBSSxDQUFDcEIsRUFBRSxDQUFDb0IsR0FBRyxDQUFDO1lBRWxCLElBQUksQ0FBQ25CLGFBQWEsR0FBRztZQUNyQkUsUUFBUUMsR0FBRyxDQUFDO1FBQ2QsRUFBRSxPQUFPaUIsT0FBTztZQUNkbEIsUUFBUWtCLEtBQUssQ0FBQyx1Q0FBdUNBO1lBQ3JELE1BQU1BO1FBQ1I7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBYUMsTUFDWEMsUUFBZ0IsRUFDaEJDLFFBQWdCLEVBQ2hCQyxTQUFnQixFQUFFLEVBQ2xCQyxNQUFjLElBQUksd0JBQXdCO0lBQXpCLEVBQ0g7UUFDZCx1Q0FBdUM7UUFDdkMsSUFBSSxDQUFDLElBQUksQ0FBQ3pCLGFBQWEsRUFBRTtZQUN2QixNQUFNLElBQUksQ0FBQ1UsVUFBVTtRQUN2QjtRQUVBLDhCQUE4QjtRQUM5QixNQUFNZ0IsYUFBYSxJQUFJLENBQUNDLFlBQVksQ0FBTUw7UUFDMUMsSUFBSUksWUFBWTtZQUNkeEIsUUFBUUMsR0FBRyxDQUFDLENBQUMsb0JBQW9CLEVBQUVtQixVQUFVO1lBQzdDLE9BQU9JO1FBQ1Q7UUFFQSw0QkFBNEI7UUFDNUJ4QixRQUFRQyxHQUFHLENBQUMsQ0FBQyxxQkFBcUIsRUFBRW1CLFNBQVMsaUJBQWlCLENBQUM7UUFDL0QsSUFBSTtZQUNGLE1BQU1NLFVBQVUsTUFBTSxJQUFJLENBQUM3QixFQUFFLENBQUU4QixHQUFHLENBQU1OLFVBQVVDO1lBRWxELGlCQUFpQjtZQUNqQixJQUFJLENBQUNNLFVBQVUsQ0FBQ1IsVUFBVU0sU0FBU0g7WUFFbkMsT0FBT0c7UUFDVCxFQUFFLE9BQU9SLE9BQU87WUFDZGxCLFFBQVFrQixLQUFLLENBQUMsQ0FBQyxxQkFBcUIsRUFBRUUsU0FBUyxDQUFDLENBQUMsRUFBRUY7WUFDbkQsTUFBTUE7UUFDUjtJQUNGO0lBRUE7O0dBRUMsR0FDRCxNQUFhVyxVQUNYVCxRQUFnQixFQUNoQkMsUUFBZ0IsRUFDaEJDLFNBQWdCLEVBQUUsRUFDbEJDLE1BQWMsR0FBRyxFQUNFO1FBQ25CLHVDQUF1QztRQUN2QyxJQUFJLENBQUMsSUFBSSxDQUFDekIsYUFBYSxFQUFFO1lBQ3ZCLE1BQU0sSUFBSSxDQUFDVSxVQUFVO1FBQ3ZCO1FBRUEsOEJBQThCO1FBQzlCLE1BQU1nQixhQUFhLElBQUksQ0FBQ0MsWUFBWSxDQUFXTDtRQUMvQyxJQUFJSSxlQUFlTSxXQUFXO1lBQzVCOUIsUUFBUUMsR0FBRyxDQUFDLENBQUMsb0JBQW9CLEVBQUVtQixVQUFVO1lBQzdDLE9BQU9JO1FBQ1Q7UUFFQSw0QkFBNEI7UUFDNUJ4QixRQUFRQyxHQUFHLENBQUMsQ0FBQyxxQkFBcUIsRUFBRW1CLFNBQVMsaUJBQWlCLENBQUM7UUFDL0QsSUFBSTtZQUNGLE1BQU1XLFNBQVMsTUFBTSxJQUFJLENBQUNsQyxFQUFFLENBQUVtQyxHQUFHLENBQUlYLFVBQVVDO1lBRS9DLGdDQUFnQztZQUNoQyxJQUFJLENBQUNNLFVBQVUsQ0FBQ1IsVUFBVVcsVUFBVSxNQUFNUjtZQUUxQyxPQUFPUSxVQUFVO1FBQ25CLEVBQUUsT0FBT2IsT0FBTztZQUNkbEIsUUFBUWtCLEtBQUssQ0FBQyxDQUFDLHFCQUFxQixFQUFFRSxTQUFTLENBQUMsQ0FBQyxFQUFFRjtZQUNuRCxNQUFNQTtRQUNSO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELE1BQWFlLDBCQUNYQyxRQUFnQixFQUFFLEVBQzBCO1FBQzVDLE1BQU1kLFdBQVcsQ0FBQyxvQkFBb0IsRUFBRWMsT0FBTztRQUUvQyxvREFBb0Q7UUFDcEQsT0FBTyxJQUFJLENBQUNmLEtBQUssQ0FDZkMsVUFDQSxDQUFDOzs7Ozs7OztXQVFJLENBQUMsRUFDTjtZQUFDYztTQUFNLEVBQ1AsSUFBSSxrQkFBa0I7O0lBRTFCO0lBRUEsTUFBYUMsMEJBQ1hDLFlBQW9CLEVBQ3BCQyxNQUF3QixFQUNMO1FBQ25CLElBQUksQ0FBQyxJQUFJLENBQUN2QyxhQUFhLEVBQUU7WUFDdkJFLFFBQVFDLEdBQUcsQ0FBQztZQUNaLE1BQU0sSUFBSSxDQUFDTyxVQUFVO1FBQ3ZCO1FBRUEsTUFBTVksV0FBV2lCLFNBQ2IsQ0FBQyxRQUFRLEVBQUVELGFBQWFFLFdBQVcsR0FBRyxDQUFDLEVBQUVELFFBQVEsR0FDakQsQ0FBQyxRQUFRLEVBQUVELGFBQWFFLFdBQVcsSUFBSTtRQUUzQyxNQUFNZCxhQUFhLElBQUksQ0FBQ0MsWUFBWSxDQUFXTDtRQUMvQyxJQUFJSSxZQUFZO1lBQ2R4QixRQUFRQyxHQUFHLENBQUMsQ0FBQyxvQkFBb0IsRUFBRW1CLFVBQVU7WUFDN0MsT0FBT0k7UUFDVDtRQUVBeEIsUUFBUUMsR0FBRyxDQUFDLENBQUMscUJBQXFCLEVBQUVtQixTQUFTLGlCQUFpQixDQUFDO1FBQy9ELElBQUk7WUFDRixNQUFNbUIsYUFBYTtnQkFDakIsQ0FBQyxvQ0FBb0MsQ0FBQztnQkFDdEMsQ0FBQyxvQ0FBb0MsQ0FBQztnQkFDdEMsQ0FBQyxzQkFBc0IsQ0FBQzthQUN6QjtZQUNELE1BQU1DLGNBQXFCO2dCQUFDSjthQUFhO1lBRXpDLDhDQUE4QztZQUM5QyxJQUFJQyxXQUFXUCxXQUFXO2dCQUN4Qix3Q0FBd0M7Z0JBQ3hDLElBQUksT0FBT08sV0FBVyxZQUFZLENBQUNJLE1BQU1DLFNBQVNMLFFBQVEsTUFBTTtvQkFDOUQsOENBQThDO29CQUM5Q0UsV0FBV0ksSUFBSSxDQUFDLENBQUMsY0FBYyxDQUFDO29CQUNoQ0gsWUFBWUcsSUFBSSxDQUFDRCxTQUFTTCxRQUFRO2dCQUNwQyxPQUFPLElBQUksT0FBT0EsV0FBVyxVQUFVO29CQUNyQywyQkFBMkI7b0JBQzNCRSxXQUFXSSxJQUFJLENBQUMsQ0FBQyxjQUFjLENBQUM7b0JBQ2hDSCxZQUFZRyxJQUFJLENBQUNOO2dCQUNuQixPQUFPO29CQUNMLDZCQUE2QjtvQkFDN0JFLFdBQVdJLElBQUksQ0FBQyxDQUFDLDJCQUEyQixDQUFDO29CQUM3Q0gsWUFBWUcsSUFBSSxDQUFDTjtnQkFDbkI7WUFDRjtZQUVBLE1BQU1sQixRQUFRb0IsV0FBV0ssSUFBSSxDQUFDO1lBQzlCLE1BQU1iLFNBQVMsTUFBTSxJQUFJLENBQUNsQyxFQUFFLENBQUU4QixHQUFHLENBQy9CUixPQUNBcUI7WUFHRixNQUFNSyxVQUFVZCxPQUFPZSxHQUFHLENBQUMsQ0FBQ0MsTUFBUUEsSUFBSUMsTUFBTSxDQUFDQyxXQUFXO1lBQzFEakQsUUFBUUMsR0FBRyxDQUNULENBQUMsZUFBZSxFQUFFNEMsUUFBUUssTUFBTSxDQUFDLGFBQWEsRUFBRWQsZUFBZUMsU0FBUyxDQUFDLGlCQUFpQixFQUFFQSxRQUFRLEdBQUcsSUFBSTtZQUc3RyxJQUFJLENBQUNULFVBQVUsQ0FBQ1IsVUFBVXlCLFNBQVM7WUFDbkMsT0FBT0E7UUFDVCxFQUFFLE9BQU8zQixPQUFPO1lBQ2RsQixRQUFRa0IsS0FBSyxDQUNYLENBQUMsK0NBQStDLEVBQUVrQixlQUFlQyxTQUFTLENBQUMsaUJBQWlCLEVBQUVBLFFBQVEsR0FBRyxHQUFHLENBQUMsQ0FBQyxFQUM5R25CO1lBRUYsT0FBTyxFQUFFO1FBQ1g7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBYWlDLHFCQUFxQk4sT0FBaUIsRUFBa0I7UUFDbkUsSUFBSSxDQUFDTyxNQUFNQyxPQUFPLENBQUNSLFlBQVlBLFFBQVFLLE1BQU0sS0FBSyxHQUFHO1lBQ25ELE9BQU8sRUFBRTtRQUNYO1FBRUEsaURBQWlEO1FBQ2pELE1BQU1uQixTQUFnQixFQUFFO1FBQ3hCLE1BQU11QixpQkFBMkIsRUFBRTtRQUVuQyxLQUFLLE1BQU1DLFFBQVFWLFFBQVM7WUFDMUIsTUFBTVcsaUJBQWlCLElBQUksQ0FBQy9CLFlBQVksQ0FBTSxDQUFDLFNBQVMsRUFBRThCLE1BQU07WUFDaEUsSUFBSUMsZ0JBQWdCO2dCQUNsQnpCLE9BQU9ZLElBQUksQ0FBQ2E7WUFDZCxPQUFPO2dCQUNMRixlQUFlWCxJQUFJLENBQUNZO1lBQ3RCO1FBQ0Y7UUFFQSw2QkFBNkI7UUFDN0IsSUFBSUQsZUFBZUosTUFBTSxHQUFHLEdBQUc7WUFDN0IsTUFBTU8sZUFBZUgsZUFBZVIsR0FBRyxDQUFDLElBQU0sS0FBS0YsSUFBSSxDQUFDO1lBQ3hELE1BQU16QixRQUFRLENBQUM7Ozt5QkFHSSxFQUFFc0MsYUFBYTtNQUNsQyxDQUFDO1lBRUQsTUFBTUMsa0JBQWtCLE1BQU0sSUFBSSxDQUFDdkMsS0FBSyxDQUN0QyxDQUFDLGVBQWUsRUFBRXdDLEtBQUtDLEdBQUcsSUFBSSxFQUM5QnpDLE9BQ0FtQyxnQkFDQSxFQUFFLHFDQUFxQzs7WUFHekMsMkJBQTJCO1lBQzNCLEtBQUssTUFBTU8sWUFBWUgsZ0JBQWlCO2dCQUN0QyxJQUFJLENBQUM5QixVQUFVLENBQUMsQ0FBQyxTQUFTLEVBQUVpQyxTQUFTYixNQUFNLEVBQUUsRUFBRWEsVUFBVTtnQkFDekQ5QixPQUFPWSxJQUFJLENBQUNrQjtZQUNkO1FBQ0Y7UUFFQSxPQUFPOUI7SUFDVDtJQUVBOztHQUVDLEdBQ0QsTUFBYStCLHdCQUF3QkMsWUFBb0IsRUFBa0I7UUFDekUsTUFBTTNDLFdBQVcsQ0FBQyxPQUFPLEVBQUUyQyxjQUFjO1FBRXpDLE9BQU8sSUFBSSxDQUFDNUMsS0FBSyxDQUNmQyxVQUNBLENBQUM7Ozs7Ozs7Ozs7OytCQVd3QixDQUFDLEVBQzFCO1lBQUMyQztTQUFhLEVBQ2QsSUFBSSxpQkFBaUI7O0lBRXpCO0lBRUE7O0dBRUMsR0FDRCxXQUFzQkMsR0FBVyxFQUFFQyxJQUFPLEVBQUUxQyxHQUFXLEVBQVE7UUFDN0QsSUFBSSxDQUFDeEIsS0FBSyxDQUFDaUUsSUFBSSxHQUFHO1lBQ2hCQztZQUNBQyxXQUFXUCxLQUFLQyxHQUFHO1lBQ25CckMsS0FBS0EsTUFBTTtRQUNiO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELGFBQXdCeUMsR0FBVyxFQUFpQjtRQUNsRCxNQUFNRyxRQUFRLElBQUksQ0FBQ3BFLEtBQUssQ0FBQ2lFLElBQUk7UUFFN0IsSUFBSSxDQUFDRyxPQUFPLE9BQU9yQztRQUVuQixzQ0FBc0M7UUFDdEMsTUFBTXNDLE1BQU1ULEtBQUtDLEdBQUcsS0FBS08sTUFBTUQsU0FBUztRQUN4QyxJQUFJRSxNQUFNRCxNQUFNNUMsR0FBRyxFQUFFO1lBQ25CLGdCQUFnQjtZQUNoQixPQUFPLElBQUksQ0FBQ3hCLEtBQUssQ0FBQ2lFLElBQUk7WUFDdEIsT0FBT2xDO1FBQ1Q7UUFFQSxPQUFPcUMsTUFBTUYsSUFBSTtJQUNuQjtJQUVBOztHQUVDLEdBQ0QsV0FBa0JELEdBQVksRUFBUTtRQUNwQyxJQUFJQSxLQUFLO1lBQ1AsT0FBTyxJQUFJLENBQUNqRSxLQUFLLENBQUNpRSxJQUFJO1lBQ3RCaEUsUUFBUUMsR0FBRyxDQUFDLENBQUMsd0JBQXdCLEVBQUUrRCxLQUFLO1FBQzlDLE9BQU87WUFDTCxJQUFJLENBQUNqRSxLQUFLLEdBQUcsQ0FBQztZQUNkQyxRQUFRQyxHQUFHLENBQUM7UUFDZDtJQUNGO0lBRUE7O0dBRUMsR0FDRCxNQUFhcUUsUUFBdUI7UUFDbEMsSUFBSSxJQUFJLENBQUN6RSxFQUFFLEVBQUU7WUFDWCxNQUFNLElBQUksQ0FBQ0EsRUFBRSxDQUFDeUUsS0FBSztZQUNuQixJQUFJLENBQUN6RSxFQUFFLEdBQUc7WUFDVixJQUFJLENBQUNDLGFBQWEsR0FBRztZQUNyQkUsUUFBUUMsR0FBRyxDQUFDO1FBQ2Q7SUFDRjtBQUNGO0FBRUEsOEJBQThCO0FBQzlCLE1BQU1zRSxZQUFZN0UsZ0JBQWdCUSxXQUFXO0FBQzdDLGlFQUFlcUUsU0FBU0EsRUFBQyIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxzYXRob1xcRG9jdW1lbnRzXFxQcm9qZWN0c1xcYWlyY3JhZnQtdHJhY2tpbmdcXGxpYlxcZGJcXERhdGFiYXNlTWFuYWdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBTaW1wbGlmaWVkRGF0YWJhc2VNYW5hZ2VyLnRzXHJcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xyXG5pbXBvcnQgc3FsaXRlMyBmcm9tICdzcWxpdGUzJztcclxuaW1wb3J0IHsgRGF0YWJhc2UsIG9wZW4gfSBmcm9tICdzcWxpdGUnO1xyXG5pbXBvcnQgZnMgZnJvbSAnZnMnO1xyXG5cclxuLy8gVHlwZSBkZWZpbml0aW9uc1xyXG5pbnRlcmZhY2UgQ2FjaGVFbnRyeTxUPiB7XHJcbiAgZGF0YTogVDtcclxuICB0aW1lc3RhbXA6IG51bWJlcjtcclxuICB0dGw6IG51bWJlcjsgLy8gVGltZSB0byBsaXZlIGluIHNlY29uZHNcclxufVxyXG5cclxudHlwZSBDYWNoZVN0b3JhZ2UgPSB7XHJcbiAgW2tleTogc3RyaW5nXTogQ2FjaGVFbnRyeTxhbnk+O1xyXG59O1xyXG5cclxuLy8gVGhlIG1haW4gZGF0YWJhc2UgbWFuYWdlciBjbGFzc1xyXG5leHBvcnQgY2xhc3MgRGF0YWJhc2VNYW5hZ2VyIHtcclxuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogRGF0YWJhc2VNYW5hZ2VyIHwgbnVsbCA9IG51bGw7XHJcbiAgcHJpdmF0ZSBkYjogRGF0YWJhc2U8c3FsaXRlMy5EYXRhYmFzZT4gfCBudWxsID0gbnVsbDtcclxuICBwcml2YXRlIGlzSW5pdGlhbGl6ZWQgPSBmYWxzZTtcclxuICBwcml2YXRlIGRiUGF0aDogc3RyaW5nO1xyXG4gIHByaXZhdGUgY2FjaGU6IENhY2hlU3RvcmFnZSA9IHt9O1xyXG5cclxuICBwcml2YXRlIGNvbnN0cnVjdG9yKGRiUGF0aDogc3RyaW5nKSB7XHJcbiAgICB0aGlzLmRiUGF0aCA9IGRiUGF0aDtcclxuICAgIGNvbnNvbGUubG9nKGBbREJdIERhdGFiYXNlIHBhdGg6ICR7dGhpcy5kYlBhdGh9YCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgc2luZ2xldG9uIGluc3RhbmNlXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBnZXRJbnN0YW5jZShkYlBhdGg/OiBzdHJpbmcpOiBEYXRhYmFzZU1hbmFnZXIge1xyXG4gICAgaWYgKCFEYXRhYmFzZU1hbmFnZXIuaW5zdGFuY2UpIHtcclxuICAgICAgLy8gRmlyc3QgdHJ5IHRvIHVzZSB0aGUgcHJvdmlkZWQgZGJQYXRoIHBhcmFtZXRlclxyXG4gICAgICBpZiAoZGJQYXRoKSB7XHJcbiAgICAgICAgRGF0YWJhc2VNYW5hZ2VyLmluc3RhbmNlID0gbmV3IERhdGFiYXNlTWFuYWdlcihkYlBhdGgpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIE90aGVyd2lzZSwgdHJ5IHRvIHVzZSB0aGUgZW52aXJvbm1lbnQgdmFyaWFibGVcclxuICAgICAgICBjb25zdCBlbnZQYXRoID0gcHJvY2Vzcy5lbnYuU1RBVElDX0RCX1BBVEg7XHJcbiAgICAgICAgaWYgKCFlbnZQYXRoKSB7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NUQVRJQ19EQl9QQVRIIG5vdCBkZWZpbmVkIGluIC5lbnYnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgRGF0YWJhc2VNYW5hZ2VyLmluc3RhbmNlID0gbmV3IERhdGFiYXNlTWFuYWdlcihlbnZQYXRoKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIERhdGFiYXNlTWFuYWdlci5pbnN0YW5jZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEluaXRpYWxpemUgdGhlIGRhdGFiYXNlIGNvbm5lY3Rpb24gYW5kIGNyZWF0ZSB0YWJsZXMgaWYgbmVlZGVkXHJcbiAgICovXHJcbiAgcHVibGljIGFzeW5jIGluaXRpYWxpemUoKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBpZiAodGhpcy5pc0luaXRpYWxpemVkKSByZXR1cm47XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gRW5zdXJlIGRpcmVjdG9yeSBleGlzdHNcclxuICAgICAgY29uc3QgZGJEaXIgPSBwYXRoLmRpcm5hbWUodGhpcy5kYlBhdGgpO1xyXG4gICAgICBpZiAoIWZzLmV4aXN0c1N5bmMoZGJEaXIpKSB7XHJcbiAgICAgICAgZnMubWtkaXJTeW5jKGRiRGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gT3BlbiBkYXRhYmFzZSBjb25uZWN0aW9uXHJcbiAgICAgIHRoaXMuZGIgPSBhd2FpdCBvcGVuKHtcclxuICAgICAgICBmaWxlbmFtZTogdGhpcy5kYlBhdGgsXHJcbiAgICAgICAgZHJpdmVyOiBzcWxpdGUzLkRhdGFiYXNlLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIFNldCBwcmFnbWFzIGZvciBiZXR0ZXIgcGVyZm9ybWFuY2VcclxuICAgICAgYXdhaXQgdGhpcy5kYi5ydW4oJ1BSQUdNQSBqb3VybmFsX21vZGUgPSBXQUw7Jyk7XHJcbiAgICAgIGF3YWl0IHRoaXMuZGIucnVuKCdQUkFHTUEgYnVzeV90aW1lb3V0ID0gNTAwMDsnKTtcclxuXHJcbiAgICAgIHRoaXMuaXNJbml0aWFsaXplZCA9IHRydWU7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdbREJdIERhdGFiYXNlIGluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseScpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignW0RCXSBGYWlsZWQgdG8gaW5pdGlhbGl6ZSBkYXRhYmFzZTonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IGRhdGEgd2l0aCBjYWNoaW5nXHJcbiAgICovXHJcbiAgcHVibGljIGFzeW5jIHF1ZXJ5PFQ+KFxyXG4gICAgY2FjaGVLZXk6IHN0cmluZyxcclxuICAgIHNxbFF1ZXJ5OiBzdHJpbmcsXHJcbiAgICBwYXJhbXM6IGFueVtdID0gW10sXHJcbiAgICB0dGw6IG51bWJlciA9IDMwMCAvLyA1IG1pbnV0ZXMgZGVmYXVsdCBUVExcclxuICApOiBQcm9taXNlPFRbXT4ge1xyXG4gICAgLy8gQ2hlY2sgaWYgd2UgbmVlZCB0byBpbml0aWFsaXplIGZpcnN0XHJcbiAgICBpZiAoIXRoaXMuaXNJbml0aWFsaXplZCkge1xyXG4gICAgICBhd2FpdCB0aGlzLmluaXRpYWxpemUoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBUcnkgdG8gZ2V0IGZyb20gY2FjaGUgZmlyc3RcclxuICAgIGNvbnN0IGNhY2hlZERhdGEgPSB0aGlzLmdldEZyb21DYWNoZTxUW10+KGNhY2hlS2V5KTtcclxuICAgIGlmIChjYWNoZWREYXRhKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGBbREJdIENhY2hlIGhpdCBmb3I6ICR7Y2FjaGVLZXl9YCk7XHJcbiAgICAgIHJldHVybiBjYWNoZWREYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENhY2hlIG1pc3MsIGV4ZWN1dGUgcXVlcnlcclxuICAgIGNvbnNvbGUubG9nKGBbREJdIENhY2hlIG1pc3MgZm9yOiAke2NhY2hlS2V5fSwgZXhlY3V0aW5nIHF1ZXJ5YCk7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgdGhpcy5kYiEuYWxsPFRbXT4oc3FsUXVlcnksIHBhcmFtcyk7XHJcblxyXG4gICAgICAvLyBTdG9yZSBpbiBjYWNoZVxyXG4gICAgICB0aGlzLnNldEluQ2FjaGUoY2FjaGVLZXksIHJlc3VsdHMsIHR0bCk7XHJcblxyXG4gICAgICByZXR1cm4gcmVzdWx0cztcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFtEQl0gUXVlcnkgZXJyb3IgZm9yICR7Y2FjaGVLZXl9OmAsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgc2luZ2xlIGl0ZW0gd2l0aCBjYWNoaW5nXHJcbiAgICovXHJcbiAgcHVibGljIGFzeW5jIGdldFNpbmdsZTxUPihcclxuICAgIGNhY2hlS2V5OiBzdHJpbmcsXHJcbiAgICBzcWxRdWVyeTogc3RyaW5nLFxyXG4gICAgcGFyYW1zOiBhbnlbXSA9IFtdLFxyXG4gICAgdHRsOiBudW1iZXIgPSAzMDBcclxuICApOiBQcm9taXNlPFQgfCBudWxsPiB7XHJcbiAgICAvLyBDaGVjayBpZiB3ZSBuZWVkIHRvIGluaXRpYWxpemUgZmlyc3RcclxuICAgIGlmICghdGhpcy5pc0luaXRpYWxpemVkKSB7XHJcbiAgICAgIGF3YWl0IHRoaXMuaW5pdGlhbGl6ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFRyeSB0byBnZXQgZnJvbSBjYWNoZSBmaXJzdFxyXG4gICAgY29uc3QgY2FjaGVkRGF0YSA9IHRoaXMuZ2V0RnJvbUNhY2hlPFQgfCBudWxsPihjYWNoZUtleSk7XHJcbiAgICBpZiAoY2FjaGVkRGF0YSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGBbREJdIENhY2hlIGhpdCBmb3I6ICR7Y2FjaGVLZXl9YCk7XHJcbiAgICAgIHJldHVybiBjYWNoZWREYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENhY2hlIG1pc3MsIGV4ZWN1dGUgcXVlcnlcclxuICAgIGNvbnNvbGUubG9nKGBbREJdIENhY2hlIG1pc3MgZm9yOiAke2NhY2hlS2V5fSwgZXhlY3V0aW5nIHF1ZXJ5YCk7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiIS5nZXQ8VD4oc3FsUXVlcnksIHBhcmFtcyk7XHJcblxyXG4gICAgICAvLyBTdG9yZSBpbiBjYWNoZSAoZXZlbiBpZiBudWxsKVxyXG4gICAgICB0aGlzLnNldEluQ2FjaGUoY2FjaGVLZXksIHJlc3VsdCB8fCBudWxsLCB0dGwpO1xyXG5cclxuICAgICAgcmV0dXJuIHJlc3VsdCB8fCBudWxsO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihgW0RCXSBRdWVyeSBlcnJvciBmb3IgJHtjYWNoZUtleX06YCwgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBtYW51ZmFjdHVyZXJzIHdpdGggYWlyY3JhZnQgY291bnRcclxuICAgKi9cclxuICBwdWJsaWMgYXN5bmMgZ2V0TWFudWZhY3R1cmVyc1dpdGhDb3VudChcclxuICAgIGxpbWl0OiBudW1iZXIgPSA3NVxyXG4gICk6IFByb21pc2U8eyBuYW1lOiBzdHJpbmc7IGNvdW50OiBudW1iZXIgfVtdPiB7XHJcbiAgICBjb25zdCBjYWNoZUtleSA9IGBtYW51ZmFjdHVyZXJzLWNvdW50LSR7bGltaXR9YDtcclxuXHJcbiAgICAvLyBRdWVyeSB3aXRoIGV4YWN0IGNvbHVtbiBjYXNlIG1hdGNoaW5nIHlvdXIgc2NoZW1hXHJcbiAgICByZXR1cm4gdGhpcy5xdWVyeTx7IG5hbWU6IHN0cmluZzsgY291bnQ6IG51bWJlciB9PihcclxuICAgICAgY2FjaGVLZXksXHJcbiAgICAgIGBTRUxFQ1QgXHJcbiAgICAgIE1BTlVGQUNUVVJFUiBBUyBuYW1lLCAgXHJcbiAgICAgIENPVU5UKCopIEFTIGNvdW50IFxyXG4gICAgRlJPTSBhaXJjcmFmdCBcclxuICAgIFdIRVJFIE1BTlVGQUNUVVJFUiBJUyBOT1QgTlVMTCBBTkQgdHJpbShNQU5VRkFDVFVSRVIpICE9ICcnIFxyXG4gICAgR1JPVVAgQlkgTUFOVUZBQ1RVUkVSIFxyXG4gICAgSEFWSU5HIGNvdW50ID4gMCBcclxuICAgIE9SREVSIEJZIGNvdW50IERFU0MgXHJcbiAgICBMSU1JVCA/YCxcclxuICAgICAgW2xpbWl0XSxcclxuICAgICAgNjAwIC8vIDEwIG1pbnV0ZSBjYWNoZVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBhc3luYyBnZXRJY2FvMjRzRm9yTWFudWZhY3R1cmVyKFxyXG4gICAgbWFudWZhY3R1cmVyOiBzdHJpbmcsXHJcbiAgICByZWdpb24/OiBudW1iZXIgfCBzdHJpbmdcclxuICApOiBQcm9taXNlPHN0cmluZ1tdPiB7XHJcbiAgICBpZiAoIXRoaXMuaXNJbml0aWFsaXplZCkge1xyXG4gICAgICBjb25zb2xlLmxvZygnW0RCXSBOb3QgaW5pdGlhbGl6ZWQsIGNhbGxpbmcgaW5pdGlhbGl6ZSgpJyk7XHJcbiAgICAgIGF3YWl0IHRoaXMuaW5pdGlhbGl6ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNhY2hlS2V5ID0gcmVnaW9uXHJcbiAgICAgID8gYElDQU8yNHMtJHttYW51ZmFjdHVyZXIudG9VcHBlckNhc2UoKX0tJHtyZWdpb259YFxyXG4gICAgICA6IGBJQ0FPMjRzLSR7bWFudWZhY3R1cmVyLnRvVXBwZXJDYXNlKCl9YDtcclxuXHJcbiAgICBjb25zdCBjYWNoZWREYXRhID0gdGhpcy5nZXRGcm9tQ2FjaGU8c3RyaW5nW10+KGNhY2hlS2V5KTtcclxuICAgIGlmIChjYWNoZWREYXRhKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGBbREJdIENhY2hlIGhpdCBmb3I6ICR7Y2FjaGVLZXl9YCk7XHJcbiAgICAgIHJldHVybiBjYWNoZWREYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKGBbREJdIENhY2hlIG1pc3MgZm9yOiAke2NhY2hlS2V5fSwgZXhlY3V0aW5nIHF1ZXJ5YCk7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBxdWVyeVBhcnRzID0gW1xyXG4gICAgICAgIGBTRUxFQ1QgRElTVElOQ1QgSUNBTzI0IEZST00gYWlyY3JhZnRgLFxyXG4gICAgICAgIGBXSEVSRSBMT1dFUihNQU5VRkFDVFVSRVIpID0gTE9XRVIoPylgLFxyXG4gICAgICAgIGBBTkQgSUNBTzI0IElTIE5PVCBOVUxMYCxcclxuICAgICAgXTtcclxuICAgICAgY29uc3QgcXVlcnlQYXJhbXM6IGFueVtdID0gW21hbnVmYWN0dXJlcl07XHJcblxyXG4gICAgICAvLyBBZGQgcmVnaW9uIGZpbHRlcmluZyBpZiByZWdpb24gaXMgc3BlY2lmaWVkXHJcbiAgICAgIGlmIChyZWdpb24gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIC8vIENoZWNrIGlmIHJlZ2lvbiBpcyBhIG51bWJlciBvciBzdHJpbmdcclxuICAgICAgICBpZiAodHlwZW9mIHJlZ2lvbiA9PT0gJ3N0cmluZycgJiYgIWlzTmFOKHBhcnNlSW50KHJlZ2lvbiwgMTApKSkge1xyXG4gICAgICAgICAgLy8gSWYgaXQncyBhIG51bWVyaWMgc3RyaW5nLCBjb252ZXJ0IHRvIG51bWJlclxyXG4gICAgICAgICAgcXVlcnlQYXJ0cy5wdXNoKGBBTkQgUkVHSU9OID0gP2ApO1xyXG4gICAgICAgICAgcXVlcnlQYXJhbXMucHVzaChwYXJzZUludChyZWdpb24sIDEwKSk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgcmVnaW9uID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgLy8gSWYgaXQncyBhbHJlYWR5IGEgbnVtYmVyXHJcbiAgICAgICAgICBxdWVyeVBhcnRzLnB1c2goYEFORCBSRUdJT04gPSA/YCk7XHJcbiAgICAgICAgICBxdWVyeVBhcmFtcy5wdXNoKHJlZ2lvbik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIEFzc3VtZSBpdCdzIGEgc3RhdGUgc3RyaW5nXHJcbiAgICAgICAgICBxdWVyeVBhcnRzLnB1c2goYEFORCBMT1dFUihTVEFURSkgPSBMT1dFUig/KWApO1xyXG4gICAgICAgICAgcXVlcnlQYXJhbXMucHVzaChyZWdpb24gYXMgc3RyaW5nKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHF1ZXJ5ID0gcXVlcnlQYXJ0cy5qb2luKCcgJyk7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIhLmFsbDx7IElDQU8yNDogc3RyaW5nIH1bXT4oXHJcbiAgICAgICAgcXVlcnksXHJcbiAgICAgICAgcXVlcnlQYXJhbXNcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGNvbnN0IElDQU8yNHMgPSByZXN1bHQubWFwKChyb3cpID0+IHJvdy5JQ0FPMjQudG9Mb3dlckNhc2UoKSk7XHJcbiAgICAgIGNvbnNvbGUubG9nKFxyXG4gICAgICAgIGBbREJdIFJldHJpZXZlZCAke0lDQU8yNHMubGVuZ3RofSBJQ0FPMjRzIGZvciAke21hbnVmYWN0dXJlcn0ke3JlZ2lvbiA/IGAgaW4gcmVnaW9uL3N0YXRlICR7cmVnaW9ufWAgOiAnJ31gXHJcbiAgICAgICk7XHJcblxyXG4gICAgICB0aGlzLnNldEluQ2FjaGUoY2FjaGVLZXksIElDQU8yNHMsIDMwMCk7XHJcbiAgICAgIHJldHVybiBJQ0FPMjRzO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcclxuICAgICAgICBgW0RCXSBFcnJvciByZXRyaWV2aW5nIElDQU8yNHMgZm9yIG1hbnVmYWN0dXJlciAke21hbnVmYWN0dXJlcn0ke3JlZ2lvbiA/IGAgaW4gcmVnaW9uL3N0YXRlICR7cmVnaW9ufWAgOiAnJ306YCxcclxuICAgICAgICBlcnJvclxyXG4gICAgICApO1xyXG4gICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgYWlyY3JhZnQgYnkgSUNBTzI0IGNvZGVzXHJcbiAgICovXHJcbiAgcHVibGljIGFzeW5jIGdldEFpcmNyYWZ0QnlJY2FvMjRzKElDQU8yNHM6IHN0cmluZ1tdKTogUHJvbWlzZTxhbnlbXT4ge1xyXG4gICAgaWYgKCFBcnJheS5pc0FycmF5KElDQU8yNHMpIHx8IElDQU8yNHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZXQgaW5kaXZpZHVhbCBhaXJjcmFmdCBmcm9tIGNhY2hlIGlmIHBvc3NpYmxlXHJcbiAgICBjb25zdCByZXN1bHQ6IGFueVtdID0gW107XHJcbiAgICBjb25zdCBtaXNzaW5nSWNhbzI0czogc3RyaW5nW10gPSBbXTtcclxuXHJcbiAgICBmb3IgKGNvbnN0IGljYW8gb2YgSUNBTzI0cykge1xyXG4gICAgICBjb25zdCBjYWNoZWRBaXJjcmFmdCA9IHRoaXMuZ2V0RnJvbUNhY2hlPGFueT4oYGFpcmNyYWZ0LSR7aWNhb31gKTtcclxuICAgICAgaWYgKGNhY2hlZEFpcmNyYWZ0KSB7XHJcbiAgICAgICAgcmVzdWx0LnB1c2goY2FjaGVkQWlyY3JhZnQpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIG1pc3NpbmdJY2FvMjRzLnB1c2goaWNhbyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBGZXRjaCBhbnkgbWlzc2luZyBhaXJjcmFmdFxyXG4gICAgaWYgKG1pc3NpbmdJY2FvMjRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc3QgcGxhY2Vob2xkZXJzID0gbWlzc2luZ0ljYW8yNHMubWFwKCgpID0+ICc/Jykuam9pbignLCcpO1xyXG4gICAgICBjb25zdCBxdWVyeSA9IGBcclxuICAgICAgICBTRUxFQ1QgKlxyXG4gICAgICAgIEZST00gYWlyY3JhZnRcclxuICAgICAgICBXSEVSRSBJQ0FPMjQgSU4gKCR7cGxhY2Vob2xkZXJzfSlcclxuICAgICAgYDtcclxuXHJcbiAgICAgIGNvbnN0IGZldGNoZWRBaXJjcmFmdCA9IGF3YWl0IHRoaXMucXVlcnk8YW55PihcclxuICAgICAgICBgYWlyY3JhZnQtYmF0Y2gtJHtEYXRlLm5vdygpfWAsIC8vIFVuaXF1ZSBrZXkgdG8gYnlwYXNzIGNhY2hlXHJcbiAgICAgICAgcXVlcnksXHJcbiAgICAgICAgbWlzc2luZ0ljYW8yNHMsXHJcbiAgICAgICAgMCAvLyBEb24ndCBjYWNoZSB0aGUgYmF0Y2ggcXVlcnkgcmVzdWx0XHJcbiAgICAgICk7XHJcblxyXG4gICAgICAvLyBDYWNoZSBpbmRpdmlkdWFsIHJlc3VsdHNcclxuICAgICAgZm9yIChjb25zdCBhaXJjcmFmdCBvZiBmZXRjaGVkQWlyY3JhZnQpIHtcclxuICAgICAgICB0aGlzLnNldEluQ2FjaGUoYGFpcmNyYWZ0LSR7YWlyY3JhZnQuSUNBTzI0fWAsIGFpcmNyYWZ0LCAzMDApO1xyXG4gICAgICAgIHJlc3VsdC5wdXNoKGFpcmNyYWZ0KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgbW9kZWxzIGJ5IE1BTlVGQUNUVVJFUlxyXG4gICAqL1xyXG4gIHB1YmxpYyBhc3luYyBnZXRNb2RlbHNCeU1hbnVmYWN0dXJlcihNQU5VRkFDVFVSRVI6IHN0cmluZyk6IFByb21pc2U8YW55W10+IHtcclxuICAgIGNvbnN0IGNhY2hlS2V5ID0gYG1vZGVscy0ke01BTlVGQUNUVVJFUn1gO1xyXG5cclxuICAgIHJldHVybiB0aGlzLnF1ZXJ5PGFueT4oXHJcbiAgICAgIGNhY2hlS2V5LFxyXG4gICAgICBgU0VMRUNUIFxyXG4gICAgICAgIE1PREVMLFxyXG4gICAgICAgIE1BTlVGQUNUVVJFUixcclxuICAgICAgICBDT1VOVChESVNUSU5DVCBJQ0FPMjQpIGFzIHRvdGFsX2NvdW50LFxyXG4gICAgICAgIE1BWChOQU1FKSBhcyBOQU1FLFxyXG4gICAgICAgIE1BWChDSVRZKSBhcyBDSVRZLFxyXG4gICAgICAgIE1BWChTVEFURSkgYXMgU1RBVEUsXHJcbiAgICAgICAgTUFYKFRZUEVfUkVHSVNUUkFOVCkgYXMgVFlQRV9SRUdJU1RSQU5UXHJcbiAgICAgIEZST00gYWlyY3JhZnRcclxuICAgICAgV0hFUkUgTUFOVUZBQ1RVUkVSID0gP1xyXG4gICAgICBHUk9VUCBCWSBNT0RFTCwgTUFOVUZBQ1RVUkVSXHJcbiAgICAgIE9SREVSIEJZIHRvdGFsX2NvdW50IERFU0NgLFxyXG4gICAgICBbTUFOVUZBQ1RVUkVSXSxcclxuICAgICAgMzAwIC8vIDUgbWludXRlIGNhY2hlXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RvcmUgZGF0YSBpbiBjYWNoZVxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2V0SW5DYWNoZTxUPihrZXk6IHN0cmluZywgZGF0YTogVCwgdHRsOiBudW1iZXIpOiB2b2lkIHtcclxuICAgIHRoaXMuY2FjaGVba2V5XSA9IHtcclxuICAgICAgZGF0YSxcclxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxyXG4gICAgICB0dGw6IHR0bCAqIDEwMDAsIC8vIENvbnZlcnQgdG8gbWlsbGlzZWNvbmRzXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IGRhdGEgZnJvbSBjYWNoZSBpZiB2YWxpZFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0RnJvbUNhY2hlPFQ+KGtleTogc3RyaW5nKTogVCB8IHVuZGVmaW5lZCB7XHJcbiAgICBjb25zdCBlbnRyeSA9IHRoaXMuY2FjaGVba2V5XTtcclxuXHJcbiAgICBpZiAoIWVudHJ5KSByZXR1cm4gdW5kZWZpbmVkO1xyXG5cclxuICAgIC8vIENoZWNrIGlmIGNhY2hlIGVudHJ5IGlzIHN0aWxsIHZhbGlkXHJcbiAgICBjb25zdCBhZ2UgPSBEYXRlLm5vdygpIC0gZW50cnkudGltZXN0YW1wO1xyXG4gICAgaWYgKGFnZSA+IGVudHJ5LnR0bCkge1xyXG4gICAgICAvLyBDYWNoZSBleHBpcmVkXHJcbiAgICAgIGRlbGV0ZSB0aGlzLmNhY2hlW2tleV07XHJcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGVudHJ5LmRhdGEgYXMgVDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENsZWFyIGVudGlyZSBjYWNoZSBvciBzcGVjaWZpYyBrZXlzXHJcbiAgICovXHJcbiAgcHVibGljIGNsZWFyQ2FjaGUoa2V5Pzogc3RyaW5nKTogdm9pZCB7XHJcbiAgICBpZiAoa2V5KSB7XHJcbiAgICAgIGRlbGV0ZSB0aGlzLmNhY2hlW2tleV07XHJcbiAgICAgIGNvbnNvbGUubG9nKGBbREJdIENsZWFyZWQgY2FjaGUgZm9yOiAke2tleX1gKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuY2FjaGUgPSB7fTtcclxuICAgICAgY29uc29sZS5sb2coJ1tEQl0gQ2xlYXJlZCBlbnRpcmUgY2FjaGUnKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENsb3NlIGRhdGFiYXNlIGNvbm5lY3Rpb25cclxuICAgKi9cclxuICBwdWJsaWMgYXN5bmMgY2xvc2UoKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBpZiAodGhpcy5kYikge1xyXG4gICAgICBhd2FpdCB0aGlzLmRiLmNsb3NlKCk7XHJcbiAgICAgIHRoaXMuZGIgPSBudWxsO1xyXG4gICAgICB0aGlzLmlzSW5pdGlhbGl6ZWQgPSBmYWxzZTtcclxuICAgICAgY29uc29sZS5sb2coJ1tEQl0gRGF0YWJhc2UgY29ubmVjdGlvbiBjbG9zZWQnKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbi8vIEV4cG9ydCBhIHNpbmdsZXRvbiBpbnN0YW5jZVxyXG5jb25zdCBkYk1hbmFnZXIgPSBEYXRhYmFzZU1hbmFnZXIuZ2V0SW5zdGFuY2UoKTtcclxuZXhwb3J0IGRlZmF1bHQgZGJNYW5hZ2VyO1xyXG4iXSwibmFtZXMiOlsicGF0aCIsInNxbGl0ZTMiLCJvcGVuIiwiZnMiLCJEYXRhYmFzZU1hbmFnZXIiLCJpbnN0YW5jZSIsImRiUGF0aCIsImRiIiwiaXNJbml0aWFsaXplZCIsImNhY2hlIiwiY29uc29sZSIsImxvZyIsImdldEluc3RhbmNlIiwiZW52UGF0aCIsInByb2Nlc3MiLCJlbnYiLCJTVEFUSUNfREJfUEFUSCIsIkVycm9yIiwiaW5pdGlhbGl6ZSIsImRiRGlyIiwiZGlybmFtZSIsImV4aXN0c1N5bmMiLCJta2RpclN5bmMiLCJyZWN1cnNpdmUiLCJmaWxlbmFtZSIsImRyaXZlciIsIkRhdGFiYXNlIiwicnVuIiwiZXJyb3IiLCJxdWVyeSIsImNhY2hlS2V5Iiwic3FsUXVlcnkiLCJwYXJhbXMiLCJ0dGwiLCJjYWNoZWREYXRhIiwiZ2V0RnJvbUNhY2hlIiwicmVzdWx0cyIsImFsbCIsInNldEluQ2FjaGUiLCJnZXRTaW5nbGUiLCJ1bmRlZmluZWQiLCJyZXN1bHQiLCJnZXQiLCJnZXRNYW51ZmFjdHVyZXJzV2l0aENvdW50IiwibGltaXQiLCJnZXRJY2FvMjRzRm9yTWFudWZhY3R1cmVyIiwibWFudWZhY3R1cmVyIiwicmVnaW9uIiwidG9VcHBlckNhc2UiLCJxdWVyeVBhcnRzIiwicXVlcnlQYXJhbXMiLCJpc05hTiIsInBhcnNlSW50IiwicHVzaCIsImpvaW4iLCJJQ0FPMjRzIiwibWFwIiwicm93IiwiSUNBTzI0IiwidG9Mb3dlckNhc2UiLCJsZW5ndGgiLCJnZXRBaXJjcmFmdEJ5SWNhbzI0cyIsIkFycmF5IiwiaXNBcnJheSIsIm1pc3NpbmdJY2FvMjRzIiwiaWNhbyIsImNhY2hlZEFpcmNyYWZ0IiwicGxhY2Vob2xkZXJzIiwiZmV0Y2hlZEFpcmNyYWZ0IiwiRGF0ZSIsIm5vdyIsImFpcmNyYWZ0IiwiZ2V0TW9kZWxzQnlNYW51ZmFjdHVyZXIiLCJNQU5VRkFDVFVSRVIiLCJrZXkiLCJkYXRhIiwidGltZXN0YW1wIiwiZW50cnkiLCJhZ2UiLCJjbGVhckNhY2hlIiwiY2xvc2UiLCJkYk1hbmFnZXIiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/db/DatabaseManager.ts\n");

/***/ }),

/***/ "(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftracking%2Flive&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ctracking%5Clive.ts&middlewareConfigBase64=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftracking%2Flive&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ctracking%5Clive.ts&middlewareConfigBase64=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api-node)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api-node)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api-node)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_tracking_live_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\tracking\\live.ts */ \"(api-node)/./pages/api/tracking/live.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_tracking_live_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_tracking_live_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_tracking_live_ts__WEBPACK_IMPORTED_MODULE_3__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_tracking_live_ts__WEBPACK_IMPORTED_MODULE_3__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/tracking/live\",\n        pathname: \"/api/tracking/live\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _pages_api_tracking_live_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtcm91dGUtbG9hZGVyL2luZGV4LmpzP2tpbmQ9UEFHRVNfQVBJJnBhZ2U9JTJGYXBpJTJGdHJhY2tpbmclMkZsaXZlJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlNUNhcGklNUN0cmFja2luZyU1Q2xpdmUudHMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQStGO0FBQ3ZDO0FBQ0U7QUFDMUQ7QUFDNEQ7QUFDNUQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLHdEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyx3REFBUTtBQUNwQztBQUNPLHdCQUF3Qix5R0FBbUI7QUFDbEQ7QUFDQSxjQUFjLGtFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQscUMiLCJzb3VyY2VzIjpbIiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzXFxcXGFwaVxcXFx0cmFja2luZ1xcXFxsaXZlLnRzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsICdkZWZhdWx0Jyk7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCAnY29uZmlnJyk7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS90cmFja2luZy9saXZlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvdHJhY2tpbmcvbGl2ZVwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6ICcnLFxuICAgICAgICBmaWxlbmFtZTogJydcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftracking%2Flive&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ctracking%5Clive.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api-node)/./pages/api/tracking/live.ts":
/*!************************************!*\
  !*** ./pages/api/tracking/live.ts ***!
  \************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_db_DatabaseManager__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/db/DatabaseManager */ \"(api-node)/./lib/db/DatabaseManager.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_db_DatabaseManager__WEBPACK_IMPORTED_MODULE_0__]);\n_lib_db_DatabaseManager__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// pages/api/tracking/live.ts\n\n// Cache for API responses\nconst TRACKING_CACHE = new Map();\nconst CACHE_TTL = 15000; // 15 seconds\nasync function handler(req, res) {\n    if (req.method !== 'POST') {\n        return res.status(405).json({\n            error: 'Method not allowed'\n        });\n    }\n    const { ICAO24s, MANUFACTURER, includeStatic = false, activeOnly = false } = req.body;\n    console.log(`[API] Received request for ${ICAO24s?.length || 0} aircraft from ${MANUFACTURER || 'unknown MANUFACTURER'}`);\n    console.log(`[API] Static data inclusion: ${includeStatic ? 'Yes' : 'No'}`);\n    if (!ICAO24s || !Array.isArray(ICAO24s) || ICAO24s.length === 0) {\n        console.log('[API] Invalid request: Missing or empty ICAO24s array');\n        return res.status(400).json({\n            error: 'Valid ICAO24s array required'\n        });\n    }\n    // Show a sample of 5 ICAOs in the request\n    const sampleIcaos = ICAO24s.slice(0, 5);\n    console.log(`[API] Sample ICAOs in request: ${sampleIcaos.join(', ')}${ICAO24s.length > 5 ? '...' : ''}`);\n    try {\n        // Get live data using the proxy API\n        const liveData = await fetchLiveAircraftData(ICAO24s);\n        console.log(`[API] Received ${liveData.length} aircraft with position data`);\n        // If static data is requested, fetch it from the database\n        let staticAircraft = {};\n        if (includeStatic && liveData.length > 0) {\n            // Get ICAO24s that have position data\n            const liveIcao24s = liveData.map((a)=>a.ICAO24);\n            console.log(`[API] Fetching static data for ${liveIcao24s.length} aircraft`);\n            const staticData = await _lib_db_DatabaseManager__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getAircraftByIcao24s(liveIcao24s);\n            console.log(`[API] Retrieved static data for ${staticData.length} aircraft`);\n            const { batchIndex, totalBatches } = req.body;\n            // Then modify your logging to include this information\n            if (batchIndex && totalBatches) {\n                console.log(`[API] Processing batch ${batchIndex}/${totalBatches} (${ICAO24s.length} ICAOs)`);\n            } else {\n                // Fall back to the existing logging\n                console.log(`[API] Processing batch 1/1 (${ICAO24s.length} ICAOs)`);\n            }\n            // Create a lookup map for faster merging\n            staticAircraft = staticData.reduce((map, aircraft)=>{\n                if (aircraft.ICAO24) {\n                    map[aircraft.ICAO24.toLowerCase()] = aircraft;\n                }\n                return map;\n            }, {});\n        }\n        // Merge live and static data\n        const mergedAircraft = liveData.map((liveAircraft)=>{\n            const icao = liveAircraft.ICAO24.toLowerCase();\n            const staticData = staticAircraft[icao] || {};\n            if (activeOnly) {\n                // Only return aircraft with position data\n                const mergedAircraft = liveData.map((liveAircraft)=>{\n                    const icao = liveAircraft.ICAO24.toLowerCase();\n                    const staticData = staticAircraft[icao] || {};\n                    return {\n                        ...staticData,\n                        ...liveAircraft,\n                        ICAO24: icao,\n                        _tracking: {\n                            MANUFACTURER,\n                            lastSeen: Date.now()\n                        }\n                    };\n                });\n                const activeAircraft = mergedAircraft.filter((aircraft)=>aircraft.latitude && aircraft.longitude);\n                console.log(`[API] Filtering to ${activeAircraft.length} active aircraft out of ${mergedAircraft.length} total`);\n            }\n            return {\n                ...staticData,\n                ...liveAircraft,\n                // Ensure consistent ICAO24 format\n                ICAO24: icao,\n                // Add tracking metadata\n                _tracking: {\n                    MANUFACTURER,\n                    lastSeen: Date.now()\n                }\n            };\n        });\n        console.log(`[API] Returning ${mergedAircraft.length} merged aircraft records`);\n        return res.status(200).json({\n            aircraft: mergedAircraft,\n            count: mergedAircraft.length,\n            timestamp: new Date().toISOString()\n        });\n    } catch (error) {\n        console.error('[API] Error fetching tracking data:', error);\n        // Return empty result to prevent frontend errors\n        return res.status(500).json({\n            error: 'Failed to fetch tracking data',\n            message: error instanceof Error ? error.message : 'Unknown error',\n            aircraft: [],\n            count: 0,\n            timestamp: new Date().toISOString()\n        });\n    }\n}\n/**\r\n * Fetch live aircraft data using the OpenSky proxy\r\n * Handles batching and rate limits through the proxy\r\n */ async function fetchLiveAircraftData(ICAO24s) {\n    // Generate a cache key based on ICAO24s\n    const cacheKey = ICAO24s.sort().join(',');\n    // Check cache first\n    const cached = TRACKING_CACHE.get(cacheKey);\n    if (cached && Date.now() - cached.timestamp < CACHE_TTL) {\n        console.log('[API] Using cached tracking data from', new Date(cached.timestamp).toLocaleTimeString());\n        return cached.data;\n    }\n    // Prepare batches (100 ICAOs per batch as per the proxy's limit)\n    const BATCH_SIZE = 100;\n    const batches = [];\n    for(let i = 0; i < ICAO24s.length; i += BATCH_SIZE){\n        batches.push(ICAO24s.slice(i, i + BATCH_SIZE));\n    }\n    console.log(`[API] Processing ${ICAO24s.length} ICAOs in ${batches.length} batches`);\n    // Process batches sequentially to respect rate limits\n    const results = [];\n    for(let i = 0; i < batches.length; i++){\n        const batch = batches[i];\n        try {\n            console.log(`[API] Processing batch ${i + 1}/${batches.length} (${batch.length} ICAOs)`);\n            // Sample of ICAOs in this batch\n            const sampleIcaos = batch.slice(0, 5);\n            console.log(`[API] Sample ICAOs in batch: ${sampleIcaos.join(', ')}${batch.length > 5 ? '...' : ''}`);\n            // Call the proxy endpoint\n            const batchResults = await fetchAircraftBatch(batch);\n            // Add to overall results\n            results.push(...batchResults);\n            // Log results\n            console.log(`[API] Batch ${i + 1} returned ${batchResults.length} aircraft with position data`);\n            // Add a small delay between batches to be nice to the proxy\n            if (i < batches.length - 1) {\n                await new Promise((resolve)=>setTimeout(resolve, 500));\n            }\n        } catch (error) {\n            console.error(`[API] Error processing batch ${i + 1}:`, error);\n        // Continue with the next batch instead of failing completely\n        }\n    }\n    // Cache the combined results\n    TRACKING_CACHE.set(cacheKey, {\n        data: results,\n        timestamp: Date.now()\n    });\n    return results;\n}\n/**\r\n * Fetch a single batch of aircraft data using the proxy API\r\n */ async function fetchAircraftBatch(ICAO24Batch) {\n    // Get base URL from environment variable or use a default\n    const baseUrl = process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:3001';\n    // Call our proxy API with absolute URL\n    const response = await fetch(`${baseUrl}/api/proxy/opensky`, {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n            ICAO24s: ICAO24Batch\n        })\n    });\n    if (!response.ok) {\n        // If we hit a rate limit, handle it gracefully\n        if (response.status === 429) {\n            const data = await response.json();\n            const retryAfter = data.retryAfter || 60;\n            console.log(`[API] Rate limited by proxy. Retry after ${retryAfter}s`);\n            // If we're dealing with a rate limit, wait and retry once\n            await new Promise((resolve)=>setTimeout(resolve, retryAfter * 1000));\n            // Retry the request\n            const baseUrl = process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:3001';\n            const retryResponse = await fetch(`${baseUrl}/api/proxy/opensky`, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    ICAO24s: ICAO24Batch\n                })\n            });\n            if (!retryResponse.ok) {\n                console.error(`[API] Retry failed with status: ${retryResponse.status}`);\n                return []; // Return empty array on retry failure\n            }\n            const retryData = await retryResponse.json();\n            return processProxyResponse(retryData);\n        }\n        // For other errors, log and return empty array\n        console.error(`[API] Proxy API error: ${response.status} ${response.statusText}`);\n        return [];\n    }\n    const data = await response.json();\n    return processProxyResponse(data);\n}\n/**\r\n * Process the response from the OpenSky proxy API\r\n */ function processProxyResponse(response) {\n    if (!response.success || !response.data || !Array.isArray(response.data.states)) {\n        console.warn('[API] Invalid response format from proxy:', response);\n        return [];\n    }\n    // The proxy already formats the data, so we can use it directly\n    return response.data.states.filter((state)=>{\n        // Ensure we only return aircraft with valid position data\n        return state && typeof state.latitude === 'number' && typeof state.longitude === 'number';\n    });\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TixLQUFLLENBQ1gsQ0FBQyx1QkFBdUIsRUFBRW1FLFNBQVNyRSxNQUFNLENBQUMsQ0FBQyxFQUFFcUUsU0FBU1UsVUFBVSxFQUFFO1FBRXBFLE9BQU8sRUFBRTtJQUNYO0lBRUEsTUFBTTVCLE9BQU8sTUFBTWtCLFNBQVNwRSxJQUFJO0lBQ2hDLE9BQU82RSxxQkFBcUIzQjtBQUM5QjtBQUVBOztDQUVDLEdBQ0QsU0FBUzJCLHFCQUFxQlQsUUFBYTtJQUN6QyxJQUNFLENBQUNBLFNBQVNXLE9BQU8sSUFDakIsQ0FBQ1gsU0FBU2xCLElBQUksSUFDZCxDQUFDeEMsTUFBTUMsT0FBTyxDQUFDeUQsU0FBU2xCLElBQUksQ0FBQzhCLE1BQU0sR0FDbkM7UUFDQXpFLFFBQVEwRSxJQUFJLENBQUMsNkNBQTZDYjtRQUMxRCxPQUFPLEVBQUU7SUFDWDtJQUVBLGdFQUFnRTtJQUNoRSxPQUFPQSxTQUFTbEIsSUFBSSxDQUFDOEIsTUFBTSxDQUFDM0MsTUFBTSxDQUFDLENBQUM2QztRQUNsQywwREFBMEQ7UUFDMUQsT0FDRUEsU0FDQSxPQUFPQSxNQUFNNUMsUUFBUSxLQUFLLFlBQzFCLE9BQU80QyxNQUFNM0MsU0FBUyxLQUFLO0lBRS9CO0FBQ0YiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcc2F0aG9cXERvY3VtZW50c1xcUHJvamVjdHNcXGFpcmNyYWZ0LXRyYWNraW5nXFxwYWdlc1xcYXBpXFx0cmFja2luZ1xcbGl2ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBwYWdlcy9hcGkvdHJhY2tpbmcvbGl2ZS50c1xyXG5pbXBvcnQgdHlwZSB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0JztcclxuaW1wb3J0IGRiTWFuYWdlciBmcm9tICcuLi8uLi8uLi9saWIvZGIvRGF0YWJhc2VNYW5hZ2VyJztcclxuaW1wb3J0IHsgQWlyY3JhZnQsIFRyYWNraW5nRGF0YSwgUmVnaW9uQ29kZSB9IGZyb20gJ0AvdHlwZXMvYmFzZSc7XHJcblxyXG4vLyBDYWNoZSBmb3IgQVBJIHJlc3BvbnNlc1xyXG5jb25zdCBUUkFDS0lOR19DQUNIRSA9IG5ldyBNYXA8c3RyaW5nLCB7IGRhdGE6IGFueTsgdGltZXN0YW1wOiBudW1iZXIgfT4oKTtcclxuY29uc3QgQ0FDSEVfVFRMID0gMTUwMDA7IC8vIDE1IHNlY29uZHNcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIoXHJcbiAgcmVxOiBOZXh0QXBpUmVxdWVzdCxcclxuICByZXM6IE5leHRBcGlSZXNwb25zZVxyXG4pIHtcclxuICBpZiAocmVxLm1ldGhvZCAhPT0gJ1BPU1QnKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDUpLmpzb24oeyBlcnJvcjogJ01ldGhvZCBub3QgYWxsb3dlZCcgfSk7XHJcbiAgfVxyXG5cclxuICBjb25zdCB7XHJcbiAgICBJQ0FPMjRzLFxyXG4gICAgTUFOVUZBQ1RVUkVSLFxyXG4gICAgaW5jbHVkZVN0YXRpYyA9IGZhbHNlLFxyXG4gICAgYWN0aXZlT25seSA9IGZhbHNlLFxyXG4gIH0gPSByZXEuYm9keTtcclxuXHJcbiAgY29uc29sZS5sb2coXHJcbiAgICBgW0FQSV0gUmVjZWl2ZWQgcmVxdWVzdCBmb3IgJHtJQ0FPMjRzPy5sZW5ndGggfHwgMH0gYWlyY3JhZnQgZnJvbSAke01BTlVGQUNUVVJFUiB8fCAndW5rbm93biBNQU5VRkFDVFVSRVInfWBcclxuICApO1xyXG4gIGNvbnNvbGUubG9nKGBbQVBJXSBTdGF0aWMgZGF0YSBpbmNsdXNpb246ICR7aW5jbHVkZVN0YXRpYyA/ICdZZXMnIDogJ05vJ31gKTtcclxuXHJcbiAgaWYgKCFJQ0FPMjRzIHx8ICFBcnJheS5pc0FycmF5KElDQU8yNHMpIHx8IElDQU8yNHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICBjb25zb2xlLmxvZygnW0FQSV0gSW52YWxpZCByZXF1ZXN0OiBNaXNzaW5nIG9yIGVtcHR5IElDQU8yNHMgYXJyYXknKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XHJcbiAgICAgIGVycm9yOiAnVmFsaWQgSUNBTzI0cyBhcnJheSByZXF1aXJlZCcsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIFNob3cgYSBzYW1wbGUgb2YgNSBJQ0FPcyBpbiB0aGUgcmVxdWVzdFxyXG4gIGNvbnN0IHNhbXBsZUljYW9zID0gSUNBTzI0cy5zbGljZSgwLCA1KTtcclxuICBjb25zb2xlLmxvZyhcclxuICAgIGBbQVBJXSBTYW1wbGUgSUNBT3MgaW4gcmVxdWVzdDogJHtzYW1wbGVJY2Fvcy5qb2luKCcsICcpfSR7SUNBTzI0cy5sZW5ndGggPiA1ID8gJy4uLicgOiAnJ31gXHJcbiAgKTtcclxuXHJcbiAgdHJ5IHtcclxuICAgIC8vIEdldCBsaXZlIGRhdGEgdXNpbmcgdGhlIHByb3h5IEFQSVxyXG4gICAgY29uc3QgbGl2ZURhdGEgPSBhd2FpdCBmZXRjaExpdmVBaXJjcmFmdERhdGEoSUNBTzI0cyk7XHJcbiAgICBjb25zb2xlLmxvZyhcclxuICAgICAgYFtBUEldIFJlY2VpdmVkICR7bGl2ZURhdGEubGVuZ3RofSBhaXJjcmFmdCB3aXRoIHBvc2l0aW9uIGRhdGFgXHJcbiAgICApO1xyXG5cclxuICAgIC8vIElmIHN0YXRpYyBkYXRhIGlzIHJlcXVlc3RlZCwgZmV0Y2ggaXQgZnJvbSB0aGUgZGF0YWJhc2VcclxuICAgIGxldCBzdGF0aWNBaXJjcmFmdDogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9O1xyXG5cclxuICAgIGlmIChpbmNsdWRlU3RhdGljICYmIGxpdmVEYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgLy8gR2V0IElDQU8yNHMgdGhhdCBoYXZlIHBvc2l0aW9uIGRhdGFcclxuICAgICAgY29uc3QgbGl2ZUljYW8yNHMgPSBsaXZlRGF0YS5tYXAoKGEpID0+IGEuSUNBTzI0KTtcclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKFxyXG4gICAgICAgIGBbQVBJXSBGZXRjaGluZyBzdGF0aWMgZGF0YSBmb3IgJHtsaXZlSWNhbzI0cy5sZW5ndGh9IGFpcmNyYWZ0YFxyXG4gICAgICApO1xyXG4gICAgICBjb25zdCBzdGF0aWNEYXRhID0gYXdhaXQgZGJNYW5hZ2VyLmdldEFpcmNyYWZ0QnlJY2FvMjRzKGxpdmVJY2FvMjRzKTtcclxuICAgICAgY29uc29sZS5sb2coXHJcbiAgICAgICAgYFtBUEldIFJldHJpZXZlZCBzdGF0aWMgZGF0YSBmb3IgJHtzdGF0aWNEYXRhLmxlbmd0aH0gYWlyY3JhZnRgXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBjb25zdCB7IGJhdGNoSW5kZXgsIHRvdGFsQmF0Y2hlcyB9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgICAvLyBUaGVuIG1vZGlmeSB5b3VyIGxvZ2dpbmcgdG8gaW5jbHVkZSB0aGlzIGluZm9ybWF0aW9uXHJcbiAgICAgIGlmIChiYXRjaEluZGV4ICYmIHRvdGFsQmF0Y2hlcykge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFxyXG4gICAgICAgICAgYFtBUEldIFByb2Nlc3NpbmcgYmF0Y2ggJHtiYXRjaEluZGV4fS8ke3RvdGFsQmF0Y2hlc30gKCR7SUNBTzI0cy5sZW5ndGh9IElDQU9zKWBcclxuICAgICAgICApO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEZhbGwgYmFjayB0byB0aGUgZXhpc3RpbmcgbG9nZ2luZ1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBbQVBJXSBQcm9jZXNzaW5nIGJhdGNoIDEvMSAoJHtJQ0FPMjRzLmxlbmd0aH0gSUNBT3MpYCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIENyZWF0ZSBhIGxvb2t1cCBtYXAgZm9yIGZhc3RlciBtZXJnaW5nXHJcbiAgICAgIHN0YXRpY0FpcmNyYWZ0ID0gc3RhdGljRGF0YS5yZWR1Y2UoKG1hcCwgYWlyY3JhZnQpID0+IHtcclxuICAgICAgICBpZiAoYWlyY3JhZnQuSUNBTzI0KSB7XHJcbiAgICAgICAgICBtYXBbYWlyY3JhZnQuSUNBTzI0LnRvTG93ZXJDYXNlKCldID0gYWlyY3JhZnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBtYXA7XHJcbiAgICAgIH0sIHt9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBNZXJnZSBsaXZlIGFuZCBzdGF0aWMgZGF0YVxyXG4gICAgY29uc3QgbWVyZ2VkQWlyY3JhZnQgPSBsaXZlRGF0YS5tYXAoKGxpdmVBaXJjcmFmdCkgPT4ge1xyXG4gICAgICBjb25zdCBpY2FvID0gbGl2ZUFpcmNyYWZ0LklDQU8yNC50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICBjb25zdCBzdGF0aWNEYXRhID0gc3RhdGljQWlyY3JhZnRbaWNhb10gfHwge307XHJcblxyXG4gICAgICBpZiAoYWN0aXZlT25seSkge1xyXG4gICAgICAgIC8vIE9ubHkgcmV0dXJuIGFpcmNyYWZ0IHdpdGggcG9zaXRpb24gZGF0YVxyXG4gICAgICAgIGNvbnN0IG1lcmdlZEFpcmNyYWZ0ID0gbGl2ZURhdGEubWFwKChsaXZlQWlyY3JhZnQpID0+IHtcclxuICAgICAgICAgIGNvbnN0IGljYW8gPSBsaXZlQWlyY3JhZnQuSUNBTzI0LnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICBjb25zdCBzdGF0aWNEYXRhID0gc3RhdGljQWlyY3JhZnRbaWNhb10gfHwge307XHJcbiAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAuLi5zdGF0aWNEYXRhLFxyXG4gICAgICAgICAgICAuLi5saXZlQWlyY3JhZnQsXHJcbiAgICAgICAgICAgIElDQU8yNDogaWNhbyxcclxuICAgICAgICAgICAgX3RyYWNraW5nOiB7XHJcbiAgICAgICAgICAgICAgTUFOVUZBQ1RVUkVSLFxyXG4gICAgICAgICAgICAgIGxhc3RTZWVuOiBEYXRlLm5vdygpLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgfTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCBhY3RpdmVBaXJjcmFmdCA9IG1lcmdlZEFpcmNyYWZ0LmZpbHRlcihcclxuICAgICAgICAgIChhaXJjcmFmdDogVHJhY2tpbmdEYXRhKSA9PiBhaXJjcmFmdC5sYXRpdHVkZSAmJiBhaXJjcmFmdC5sb25naXR1ZGVcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBjb25zb2xlLmxvZyhcclxuICAgICAgICAgIGBbQVBJXSBGaWx0ZXJpbmcgdG8gJHthY3RpdmVBaXJjcmFmdC5sZW5ndGh9IGFjdGl2ZSBhaXJjcmFmdCBvdXQgb2YgJHttZXJnZWRBaXJjcmFmdC5sZW5ndGh9IHRvdGFsYFxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgLi4uc3RhdGljRGF0YSxcclxuICAgICAgICAuLi5saXZlQWlyY3JhZnQsXHJcbiAgICAgICAgLy8gRW5zdXJlIGNvbnNpc3RlbnQgSUNBTzI0IGZvcm1hdFxyXG4gICAgICAgIElDQU8yNDogaWNhbyxcclxuICAgICAgICAvLyBBZGQgdHJhY2tpbmcgbWV0YWRhdGFcclxuICAgICAgICBfdHJhY2tpbmc6IHtcclxuICAgICAgICAgIE1BTlVGQUNUVVJFUixcclxuICAgICAgICAgIGxhc3RTZWVuOiBEYXRlLm5vdygpLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH07XHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zb2xlLmxvZyhcclxuICAgICAgYFtBUEldIFJldHVybmluZyAke21lcmdlZEFpcmNyYWZ0Lmxlbmd0aH0gbWVyZ2VkIGFpcmNyYWZ0IHJlY29yZHNgXHJcbiAgICApO1xyXG5cclxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7XHJcbiAgICAgIGFpcmNyYWZ0OiBtZXJnZWRBaXJjcmFmdCxcclxuICAgICAgY291bnQ6IG1lcmdlZEFpcmNyYWZ0Lmxlbmd0aCxcclxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignW0FQSV0gRXJyb3IgZmV0Y2hpbmcgdHJhY2tpbmcgZGF0YTonLCBlcnJvcik7XHJcblxyXG4gICAgLy8gUmV0dXJuIGVtcHR5IHJlc3VsdCB0byBwcmV2ZW50IGZyb250ZW5kIGVycm9yc1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gZmV0Y2ggdHJhY2tpbmcgZGF0YScsXHJcbiAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxyXG4gICAgICBhaXJjcmFmdDogW10sXHJcbiAgICAgIGNvdW50OiAwLFxyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEZldGNoIGxpdmUgYWlyY3JhZnQgZGF0YSB1c2luZyB0aGUgT3BlblNreSBwcm94eVxyXG4gKiBIYW5kbGVzIGJhdGNoaW5nIGFuZCByYXRlIGxpbWl0cyB0aHJvdWdoIHRoZSBwcm94eVxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hMaXZlQWlyY3JhZnREYXRhKElDQU8yNHM6IHN0cmluZ1tdKTogUHJvbWlzZTxBaXJjcmFmdFtdPiB7XHJcbiAgLy8gR2VuZXJhdGUgYSBjYWNoZSBrZXkgYmFzZWQgb24gSUNBTzI0c1xyXG4gIGNvbnN0IGNhY2hlS2V5ID0gSUNBTzI0cy5zb3J0KCkuam9pbignLCcpO1xyXG5cclxuICAvLyBDaGVjayBjYWNoZSBmaXJzdFxyXG4gIGNvbnN0IGNhY2hlZCA9IFRSQUNLSU5HX0NBQ0hFLmdldChjYWNoZUtleSk7XHJcbiAgaWYgKGNhY2hlZCAmJiBEYXRlLm5vdygpIC0gY2FjaGVkLnRpbWVzdGFtcCA8IENBQ0hFX1RUTCkge1xyXG4gICAgY29uc29sZS5sb2coXHJcbiAgICAgICdbQVBJXSBVc2luZyBjYWNoZWQgdHJhY2tpbmcgZGF0YSBmcm9tJyxcclxuICAgICAgbmV3IERhdGUoY2FjaGVkLnRpbWVzdGFtcCkudG9Mb2NhbGVUaW1lU3RyaW5nKClcclxuICAgICk7XHJcbiAgICByZXR1cm4gY2FjaGVkLmRhdGE7XHJcbiAgfVxyXG5cclxuICAvLyBQcmVwYXJlIGJhdGNoZXMgKDEwMCBJQ0FPcyBwZXIgYmF0Y2ggYXMgcGVyIHRoZSBwcm94eSdzIGxpbWl0KVxyXG4gIGNvbnN0IEJBVENIX1NJWkUgPSAxMDA7XHJcbiAgY29uc3QgYmF0Y2hlczogc3RyaW5nW11bXSA9IFtdO1xyXG5cclxuICBmb3IgKGxldCBpID0gMDsgaSA8IElDQU8yNHMubGVuZ3RoOyBpICs9IEJBVENIX1NJWkUpIHtcclxuICAgIGJhdGNoZXMucHVzaChJQ0FPMjRzLnNsaWNlKGksIGkgKyBCQVRDSF9TSVpFKSk7XHJcbiAgfVxyXG5cclxuICBjb25zb2xlLmxvZyhcclxuICAgIGBbQVBJXSBQcm9jZXNzaW5nICR7SUNBTzI0cy5sZW5ndGh9IElDQU9zIGluICR7YmF0Y2hlcy5sZW5ndGh9IGJhdGNoZXNgXHJcbiAgKTtcclxuXHJcbiAgLy8gUHJvY2VzcyBiYXRjaGVzIHNlcXVlbnRpYWxseSB0byByZXNwZWN0IHJhdGUgbGltaXRzXHJcbiAgY29uc3QgcmVzdWx0czogQWlyY3JhZnRbXSA9IFtdO1xyXG5cclxuICBmb3IgKGxldCBpID0gMDsgaSA8IGJhdGNoZXMubGVuZ3RoOyBpKyspIHtcclxuICAgIGNvbnN0IGJhdGNoID0gYmF0Y2hlc1tpXTtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKFxyXG4gICAgICAgIGBbQVBJXSBQcm9jZXNzaW5nIGJhdGNoICR7aSArIDF9LyR7YmF0Y2hlcy5sZW5ndGh9ICgke2JhdGNoLmxlbmd0aH0gSUNBT3MpYFxyXG4gICAgICApO1xyXG5cclxuICAgICAgLy8gU2FtcGxlIG9mIElDQU9zIGluIHRoaXMgYmF0Y2hcclxuICAgICAgY29uc3Qgc2FtcGxlSWNhb3MgPSBiYXRjaC5zbGljZSgwLCA1KTtcclxuICAgICAgY29uc29sZS5sb2coXHJcbiAgICAgICAgYFtBUEldIFNhbXBsZSBJQ0FPcyBpbiBiYXRjaDogJHtzYW1wbGVJY2Fvcy5qb2luKCcsICcpfSR7YmF0Y2gubGVuZ3RoID4gNSA/ICcuLi4nIDogJyd9YFxyXG4gICAgICApO1xyXG5cclxuICAgICAgLy8gQ2FsbCB0aGUgcHJveHkgZW5kcG9pbnRcclxuICAgICAgY29uc3QgYmF0Y2hSZXN1bHRzID0gYXdhaXQgZmV0Y2hBaXJjcmFmdEJhdGNoKGJhdGNoKTtcclxuXHJcbiAgICAgIC8vIEFkZCB0byBvdmVyYWxsIHJlc3VsdHNcclxuICAgICAgcmVzdWx0cy5wdXNoKC4uLmJhdGNoUmVzdWx0cyk7XHJcblxyXG4gICAgICAvLyBMb2cgcmVzdWx0c1xyXG4gICAgICBjb25zb2xlLmxvZyhcclxuICAgICAgICBgW0FQSV0gQmF0Y2ggJHtpICsgMX0gcmV0dXJuZWQgJHtiYXRjaFJlc3VsdHMubGVuZ3RofSBhaXJjcmFmdCB3aXRoIHBvc2l0aW9uIGRhdGFgXHJcbiAgICAgICk7XHJcblxyXG4gICAgICAvLyBBZGQgYSBzbWFsbCBkZWxheSBiZXR3ZWVuIGJhdGNoZXMgdG8gYmUgbmljZSB0byB0aGUgcHJveHlcclxuICAgICAgaWYgKGkgPCBiYXRjaGVzLmxlbmd0aCAtIDEpIHtcclxuICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCA1MDApKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihgW0FQSV0gRXJyb3IgcHJvY2Vzc2luZyBiYXRjaCAke2kgKyAxfTpgLCBlcnJvcik7XHJcbiAgICAgIC8vIENvbnRpbnVlIHdpdGggdGhlIG5leHQgYmF0Y2ggaW5zdGVhZCBvZiBmYWlsaW5nIGNvbXBsZXRlbHlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIENhY2hlIHRoZSBjb21iaW5lZCByZXN1bHRzXHJcbiAgVFJBQ0tJTkdfQ0FDSEUuc2V0KGNhY2hlS2V5LCB7XHJcbiAgICBkYXRhOiByZXN1bHRzLFxyXG4gICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxyXG4gIH0pO1xyXG5cclxuICByZXR1cm4gcmVzdWx0cztcclxufVxyXG5cclxuLyoqXHJcbiAqIEZldGNoIGEgc2luZ2xlIGJhdGNoIG9mIGFpcmNyYWZ0IGRhdGEgdXNpbmcgdGhlIHByb3h5IEFQSVxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hBaXJjcmFmdEJhdGNoKElDQU8yNEJhdGNoOiBzdHJpbmdbXSk6IFByb21pc2U8QWlyY3JhZnRbXT4ge1xyXG4gIC8vIEdldCBiYXNlIFVSTCBmcm9tIGVudmlyb25tZW50IHZhcmlhYmxlIG9yIHVzZSBhIGRlZmF1bHRcclxuICBjb25zdCBiYXNlVXJsID1cclxuICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0FQSV9CQVNFX1VSTCB8fCAnaHR0cDovL2xvY2FsaG9zdDozMDAxJztcclxuXHJcbiAgLy8gQ2FsbCBvdXIgcHJveHkgQVBJIHdpdGggYWJzb2x1dGUgVVJMXHJcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtiYXNlVXJsfS9hcGkvcHJveHkvb3BlbnNreWAsIHtcclxuICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgaGVhZGVyczoge1xyXG4gICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgfSxcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgSUNBTzI0czogSUNBTzI0QmF0Y2ggfSksXHJcbiAgfSk7XHJcblxyXG4gIGlmICghcmVzcG9uc2Uub2spIHtcclxuICAgIC8vIElmIHdlIGhpdCBhIHJhdGUgbGltaXQsIGhhbmRsZSBpdCBncmFjZWZ1bGx5XHJcbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MjkpIHtcclxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgY29uc3QgcmV0cnlBZnRlciA9IGRhdGEucmV0cnlBZnRlciB8fCA2MDtcclxuICAgICAgY29uc29sZS5sb2coYFtBUEldIFJhdGUgbGltaXRlZCBieSBwcm94eS4gUmV0cnkgYWZ0ZXIgJHtyZXRyeUFmdGVyfXNgKTtcclxuXHJcbiAgICAgIC8vIElmIHdlJ3JlIGRlYWxpbmcgd2l0aCBhIHJhdGUgbGltaXQsIHdhaXQgYW5kIHJldHJ5IG9uY2VcclxuICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgcmV0cnlBZnRlciAqIDEwMDApKTtcclxuXHJcbiAgICAgIC8vIFJldHJ5IHRoZSByZXF1ZXN0XHJcbiAgICAgIGNvbnN0IGJhc2VVcmwgPVxyXG4gICAgICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0FQSV9CQVNFX1VSTCB8fCAnaHR0cDovL2xvY2FsaG9zdDozMDAxJztcclxuICAgICAgY29uc3QgcmV0cnlSZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke2Jhc2VVcmx9L2FwaS9wcm94eS9vcGVuc2t5YCwge1xyXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9LFxyXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgSUNBTzI0czogSUNBTzI0QmF0Y2ggfSksXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaWYgKCFyZXRyeVJlc3BvbnNlLm9rKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcclxuICAgICAgICAgIGBbQVBJXSBSZXRyeSBmYWlsZWQgd2l0aCBzdGF0dXM6ICR7cmV0cnlSZXNwb25zZS5zdGF0dXN9YFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgcmV0dXJuIFtdOyAvLyBSZXR1cm4gZW1wdHkgYXJyYXkgb24gcmV0cnkgZmFpbHVyZVxyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCByZXRyeURhdGEgPSBhd2FpdCByZXRyeVJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgcmV0dXJuIHByb2Nlc3NQcm94eVJlc3BvbnNlKHJldHJ5RGF0YSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRm9yIG90aGVyIGVycm9ycywgbG9nIGFuZCByZXR1cm4gZW1wdHkgYXJyYXlcclxuICAgIGNvbnNvbGUuZXJyb3IoXHJcbiAgICAgIGBbQVBJXSBQcm94eSBBUEkgZXJyb3I6ICR7cmVzcG9uc2Uuc3RhdHVzfSAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YFxyXG4gICAgKTtcclxuICAgIHJldHVybiBbXTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcbiAgcmV0dXJuIHByb2Nlc3NQcm94eVJlc3BvbnNlKGRhdGEpO1xyXG59XHJcblxyXG4vKipcclxuICogUHJvY2VzcyB0aGUgcmVzcG9uc2UgZnJvbSB0aGUgT3BlblNreSBwcm94eSBBUElcclxuICovXHJcbmZ1bmN0aW9uIHByb2Nlc3NQcm94eVJlc3BvbnNlKHJlc3BvbnNlOiBhbnkpOiBBaXJjcmFmdFtdIHtcclxuICBpZiAoXHJcbiAgICAhcmVzcG9uc2Uuc3VjY2VzcyB8fFxyXG4gICAgIXJlc3BvbnNlLmRhdGEgfHxcclxuICAgICFBcnJheS5pc0FycmF5KHJlc3BvbnNlLmRhdGEuc3RhdGVzKVxyXG4gICkge1xyXG4gICAgY29uc29sZS53YXJuKCdbQVBJXSBJbnZhbGlkIHJlc3BvbnNlIGZvcm1hdCBmcm9tIHByb3h5OicsIHJlc3BvbnNlKTtcclxuICAgIHJldHVybiBbXTtcclxuICB9XHJcblxyXG4gIC8vIFRoZSBwcm94eSBhbHJlYWR5IGZvcm1hdHMgdGhlIGRhdGEsIHNvIHdlIGNhbiB1c2UgaXQgZGlyZWN0bHlcclxuICByZXR1cm4gcmVzcG9uc2UuZGF0YS5zdGF0ZXMuZmlsdGVyKChzdGF0ZTogYW55KSA9PiB7XHJcbiAgICAvLyBFbnN1cmUgd2Ugb25seSByZXR1cm4gYWlyY3JhZnQgd2l0aCB2YWxpZCBwb3NpdGlvbiBkYXRhXHJcbiAgICByZXR1cm4gKFxyXG4gICAgICBzdGF0ZSAmJlxyXG4gICAgICB0eXBlb2Ygc3RhdGUubGF0aXR1ZGUgPT09ICdudW1iZXInICYmXHJcbiAgICAgIHR5cGVvZiBzdGF0ZS5sb25naXR1ZGUgPT09ICdudW1iZXInXHJcbiAgICApO1xyXG4gIH0pO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJkYk1hbmFnZXIiLCJUUkFDS0lOR19DQUNIRSIsIk1hcCIsIkNBQ0hFX1RUTCIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJtZXRob2QiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJJQ0FPMjRzIiwiTUFOVUZBQ1RVUkVSIiwiaW5jbHVkZVN0YXRpYyIsImFjdGl2ZU9ubHkiLCJib2R5IiwiY29uc29sZSIsImxvZyIsImxlbmd0aCIsIkFycmF5IiwiaXNBcnJheSIsInNhbXBsZUljYW9zIiwic2xpY2UiLCJqb2luIiwibGl2ZURhdGEiLCJmZXRjaExpdmVBaXJjcmFmdERhdGEiLCJzdGF0aWNBaXJjcmFmdCIsImxpdmVJY2FvMjRzIiwibWFwIiwiYSIsIklDQU8yNCIsInN0YXRpY0RhdGEiLCJnZXRBaXJjcmFmdEJ5SWNhbzI0cyIsImJhdGNoSW5kZXgiLCJ0b3RhbEJhdGNoZXMiLCJyZWR1Y2UiLCJhaXJjcmFmdCIsInRvTG93ZXJDYXNlIiwibWVyZ2VkQWlyY3JhZnQiLCJsaXZlQWlyY3JhZnQiLCJpY2FvIiwiX3RyYWNraW5nIiwibGFzdFNlZW4iLCJEYXRlIiwibm93IiwiYWN0aXZlQWlyY3JhZnQiLCJmaWx0ZXIiLCJsYXRpdHVkZSIsImxvbmdpdHVkZSIsImNvdW50IiwidGltZXN0YW1wIiwidG9JU09TdHJpbmciLCJtZXNzYWdlIiwiRXJyb3IiLCJjYWNoZUtleSIsInNvcnQiLCJjYWNoZWQiLCJnZXQiLCJ0b0xvY2FsZVRpbWVTdHJpbmciLCJkYXRhIiwiQkFUQ0hfU0laRSIsImJhdGNoZXMiLCJpIiwicHVzaCIsInJlc3VsdHMiLCJiYXRjaCIsImJhdGNoUmVzdWx0cyIsImZldGNoQWlyY3JhZnRCYXRjaCIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsInNldCIsIklDQU8yNEJhdGNoIiwiYmFzZVVybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19BUElfQkFTRV9VUkwiLCJyZXNwb25zZSIsImZldGNoIiwiaGVhZGVycyIsIkpTT04iLCJzdHJpbmdpZnkiLCJvayIsInJldHJ5QWZ0ZXIiLCJyZXRyeVJlc3BvbnNlIiwicmV0cnlEYXRhIiwicHJvY2Vzc1Byb3h5UmVzcG9uc2UiLCJzdGF0dXNUZXh0Iiwic3VjY2VzcyIsInN0YXRlcyIsIndhcm4iLCJzdGF0ZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./pages/api/tracking/live.ts\n");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "sqlite":
/*!*************************!*\
  !*** external "sqlite" ***!
  \*************************/
/***/ ((module) => {

module.exports = import("sqlite");;

/***/ }),

/***/ "sqlite3":
/*!**************************!*\
  !*** external "sqlite3" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("sqlite3");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftracking%2Flive&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ctracking%5Clive.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();